(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,a){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="plugins/TagManager/vue/dist/",a(a.s="fae3")}({"19dc":function(t,a){t.exports=e},"8bbf":function(e,a){e.exports=t},a5a2:function(e,t){e.exports=a},fae3:function(e,t,a){"use strict";if(a.r(t),a.d(t,"ImportVersion",(function(){return p})),a.d(t,"VariableSelect",(function(){return q})),a.d(t,"VariableSelectType",(function(){return te})),a.d(t,"FieldTextareaVariable",(function(){return Io})),a.d(t,"FieldVariableTemplate",(function(){return zo})),a.d(t,"FieldVariableTypeTemplate",(function(){return Qo})),a.d(t,"VariableEdit",(function(){return at})),a.d(t,"VariableList",(function(){return Gt})),a.d(t,"VariableManage",(function(){return Kt})),a.d(t,"TriggerEdit",(function(){return Ja})),a.d(t,"TriggerList",(function(){return wn})),a.d(t,"TriggerManage",(function(){return _n})),a.d(t,"TagEdit",(function(){return Fr})),a.d(t,"TagList",(function(){return yo})),a.d(t,"TagManage",(function(){return ko})),"undefined"!==typeof window){var n=window.document.currentScript,i=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(a.p=i[1])}var r=a("19dc"),o=a("8bbf"),l={class:"tagManagerImportVersion"},c={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},s=["value"],d=["value"];function u(e,t,a,n,i,r){var u=Object(o["resolveComponent"])("ActivityIndicator"),g=Object(o["resolveComponent"])("Field"),b=Object(o["resolveComponent"])("SaveButton"),m=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createVNode"])(m,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(o["createVNode"])(u,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(g,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(g,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(o["createVNode"])(b,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",c,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,s),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,d)],512)])}var g=a("a5a2"),b="importContainerVersion",m=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:r["ContentBlock"],ActivityIndicator:r["ActivityIndicator"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,type:"transient",id:b});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},importVersion:function(e,t){var a=this;if(t){var n;try{n=JSON.parse(t)}catch(i){return void this.showNotification(Object(r["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in n&&"triggers"in n&&"variables"in n&&"idcontainer"in n&&"context"in n?r["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){a.isUpdating=!0;var e={exportedContainerVersion:t};r["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:a.idContainer,backupName:a.backupName},e).then((function(){a.showNotification(Object(r["translate"])("TagManager_VersionImportSuccess"),"success"),a.isUpdating=!1,window.location.reload()})).catch((function(){a.isUpdating=!1}))}}):this.showNotification(Object(r["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(r["translate"])("TagManager_BackupVersionName")," (").concat(Object(r["translate"])("General_Recommended"),")")}}});m.render=u;var p=m,f=(Object(r["createAngularJsAdapter"])({component:p,scope:{idContainer:{angularJsBind:"="}},directiveName:"piwikImportVersion"}),{class:"tagManagerManageSelect tagManagerVariableSelect"}),h={class:"tableActionBar"},v=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),j={class:"collection with-header"},O={class:"collection-header"},T=["onClick"],V={class:"title"},y={class:"secondary-content"},C=["onClick","title"],N={class:"collection-header"},E=["onClick"],w={class:"title"},S={class:"secondary-content"},k=["title"],M={class:"tableActionBar"},_=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function D(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ActivityIndicator");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",f,[Object(o["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(o["createElementVNode"])("div",h,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[v,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])]),Object(o["createElementVNode"])("ul",j,[Object(o["createElementVNode"])("li",O,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",onClick:function(a){return e.selectVariable(t)},key:a},[Object(o["createElementVNode"])("span",V,Object(o["toDisplayString"])(t.name)+" ("+Object(o["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(o["toDisplayString"])(t.type)+") ",1),Object(o["createElementVNode"])("span",y,[Object(o["createElementVNode"])("i",{class:"icon-edit",onClick:Object(o["withModifiers"])((function(a){return e.editVariable(t)}),["stop"]),title:e.translate("General_Edit")},null,8,C)])],8,T)})),128))]),Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.preconfiguredVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",N,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:a,onClick:function(a){return e.selectVariable(t)}},[Object(o["createElementVNode"])("span",w,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",S,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,k)],512),[[o["vShow"],!!t.description]])],8,E)),[[o["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(o["createElementVNode"])("div",M,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[_,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.translate("TagManager_Variable"))),1)],512),[[o["vShow"],!e.isLoading]])])])}function A(e){return x(e)||L(e)||U(e)||B()}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function U(e,t){if(e){if("string"===typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}function L(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function x(e){if(Array.isArray(e))return I(e)}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var P=window,F=P.tagManagerHelper,H=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:Number},components:{ActivityIndicator:r["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=Object.assign(Object.assign({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(a=e.containerVariables).push.apply(a,A(t.types.filter((function(e){return!e.is_pre_configured})))),n.types.length&&e.preconfiguredVariables.push(n)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&F.editVariable(null,this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});H.render=D;var q=H,$=(Object(r["createAngularJsAdapter"])({component:q,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},onSelectVariable:{angularJsBind:"&?",vue:"selectVariable"}},directiveName:"piwikVariableSelect"}),{class:"tagManagerManageSelect tagManagerVariableSelectType"}),G=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1);
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function J(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",$,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(o["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[G,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewX",e.variableTypeName)),1)],512),[[o["vShow"],!e.isLoading]])])}function R(e){return K(e)||X(e)||z(e)||W()}function W(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function z(e,t){if(e){if("string"===typeof e)return Y(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Y(e,t):void 0}}function X(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function K(e){if(Array.isArray(e))return Y(e)}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Q=window,Z=Q.tagManagerHelper,ee=Object(o["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:g["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var a,n=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(a=e.containerVariables).push.apply(a,R(n))})),e.modelValue||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&Z.editVariable(null,r["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:r["MatomoUrl"].parsed.value.idContainer})}}});ee.render=J;var te=ee;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:te,scope:{variableTypeName:{angularJsBind:"@"},variable:{angularJsBind:"=",vue:"modelValue",default:function(e){return e.variable}},variableType:{angularJsBind:"@"}},directiveName:"piwikVariableSelectType",$inject:["$timeout"],events:{"update:modelValue":function(e,t,a,n,i,o,l){a.variable=Object(r["clone"])(e),l()}},postCreate:function(e,t){t.$watch("variable",(function(t,a){t!==a&&Object(o["nextTick"])((function(){e.modelValue=Object(r["clone"])(t)}))}))}});function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ne={class:"editVariable tagManagerManageEdit",ref:"root"},ie={class:"loadingPiwik"},re=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),oe={class:"loadingPiwik"},le=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ce={key:0,class:"form-group row"},se={class:"col s12"},de={key:1},ue={class:"form-group row"},ge={class:"col s12"},be={class:"innerFormField"},me={class:"form-group row"},pe={class:"col s12 m12"},fe={for:"lookup_table"},he={class:"innerFormField comparisonField"},ve={class:"innerFormField"},je={class:"innerFormField"},Oe=["onClick","title"],Te={class:"entityCancel"},Ve={id:"confirmSelectVariableType"},ye={class:"collection-header"},Ce=["onClick","title"],Ne=["src"],Ee={class:"title"},we={class:"secondary-content"},Se=["title"],ke={class:"entityCancel"};function Me(e,t,a,n,i,r){var l=this,c=Object(o["resolveComponent"])("Field"),s=Object(o["resolveComponent"])("GroupedSettings"),d=Object(o["resolveComponent"])("SaveButton"),u=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ne,[Object(o["createVNode"])(u,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,u;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",ie,[re,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",oe,[le,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[7]||(t[7]=function(t){return e.edit?e.updateVariable():e.createVariable()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"type","model-value":e.variable.name,disabled:!0,"inline-help":e.typeInlineHelp,title:e.translate("TagManager_Type")},null,8,["model-value","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{uicontrol:"text",name:"name","model-value":e.variable.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.variable.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_VariableNameHelp")},null,8,["model-value","title","inline-help"])]),null!==(a=e.variable.typeMetadata)&&void 0!==a&&null!==(n=a.parameters)&&void 0!==n&&n.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",ce,[Object(o["createElementVNode"])("div",se,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureThisVariable")),1)])])):Object(o["createCommentVNode"])("",!0),e.variable?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",de,[Object(o["createVNode"])(s,{settings:(null===(i=e.variable.typeMetadata)||void 0===i?void 0:i.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[1]||(t[1]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ue,[Object(o["createElementVNode"])("div",ge,[Object(o["createElementVNode"])("h3",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"showAdvancedSettings",onClick:t[2]||(t[2]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[o["vShow"],!e.showAdvanced]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"hideAdvancedSettings",onClick:t[3]||(t[3]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[o["vShow"],e.showAdvanced]])])])],512),[[o["vShow"],null===(r=e.variable.typeMetadata)||void 0===r?void 0:r.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",be,[Object(o["createVNode"])(c,{uicontrol:"text",name:"default_value","model-value":e.variable.default_value,"onUpdate:modelValue":t[4]||(t[4]=function(t){e.variable.default_value=t,e.setValueHasChanged()}),title:e.translate("TagManager_DefaultValue"),"inline-help":e.translate("TagManager_DefaultValueHelp")},null,8,["model-value","title","inline-help"])]),Object(o["createElementVNode"])("div",me,[Object(o["createElementVNode"])("div",pe,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("label",fe,Object(o["toDisplayString"])(e.translate("TagManager_LookupTableTitle")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variable.lookup_table,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:a,class:Object(o["normalizeClass"])("lookupTable lookupTable".concat(a," multiple valign-wrapper"))},[Object(o["createElementVNode"])("div",he,[Object(o["createVNode"])(c,{uicontrol:"select",name:"lookup_table_comparison","model-value":t.comparison,"onUpdate:modelValue":function(a){t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableLookUpComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(o["createElementVNode"])("div",ve,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_matchvalue","model-value":t.match_value,"onUpdate:modelValue":function(a){t.match_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableMatchValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),Object(o["createElementVNode"])("div",je,[Object(o["createVNode"])(c,{uicontrol:"text",name:"lookup_table_outvalue","model-value":t.out_value,"onUpdate:modelValue":function(a){t.out_value=a,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableOutValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),a+1!==e.variable.lookup_table.length?(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:0,class:"icon-minus valign",onClick:function(t){return e.removeLookUpEntry(a)},title:e.translate("General_Remove")},null,8,Oe)):Object(o["createCommentVNode"])("",!0)],2)})),128))])])])],512),[[o["vShow"],e.showAdvanced&&(null===(u=e.variable.typeMetadata)||void 0===u?void 0:u.hasAdvancedSettings)]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(d,{class:"createButton",onConfirm:t[5]||(t[5]=function(t){return e.edit?e.updateVariable():e.createVariable()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewVariable")},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isVariableDisabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Te,[Object(o["createElementVNode"])("a",{onClick:t[6]||(t[6]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])])],544),[[o["vShow"],!e.chooseVariableType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Ve,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableVariables,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(o["createElementVNode"])("li",ye,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{key:a,class:Object(o["normalizeClass"])(["collection-item avatar",ae({disabledTemplate:l.isVariableTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createVariableType(t)},title:l.isVariableTemplateDisabled[t.id]?e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates")):""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,Ne)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",Ee,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",we,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Se)],512),[[o["vShow"],!!t.help]])],10,Ce)})),128))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ke,[Object(o["createElementVNode"])("a",{onClick:t[8]||(t[8]=Object(o["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])],512),[[o["vShow"],e.chooseVariableType]])]})),_:1},8,["content-title"])],512)}function _e(e,t){return Be(e)||Ae(e,t)||Ie(e,t)||De()}function De(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ae(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function Be(e){if(Array.isArray(e))return e}function Ue(e){return Ue="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ue(e)}function Le(e){return Fe(e)||Pe(e)||Ie(e)||xe()}function xe(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ie(e,t){if(e){if("string"===typeof e)return He(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?He(e,t):void 0}}function Pe(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Fe(e){if(Array.isArray(e))return He(e)}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function qe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ge(e,t,a){return t&&$e(e.prototype,t),a&&$e(e,a),e}function Je(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Re=function(){function e(){var t=this;qe(this,e),Je(this,"privateState",Object(o["reactive"])({variables:[],isLoadingVars:!1,isLoadingSingle:!1,isUpdating:!1})),Je(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Je(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingVars||e.isLoadingSingle}))),Je(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),Je(this,"variables",Object(o["computed"])((function(){return t.state.value.variables}))),Je(this,"fetchPromise",null),Je(this,"availableVariablesPromises",{})}return Ge(e,[{key:"fetchVariablesIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchVariables(e,t)}},{key:"findVariable",value:function(e,t,a){var n=this,i=this.variables.value.find((function(e){return e.idvariable===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idVariable:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerVariable",filter_limit:"-1"}).then((function(e){return n.privateState.variables=[].concat(Le(n.privateState.variables),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"fetchVariables",value:function(e,t){var a=this;return this.privateState.isLoadingVars=!0,this.privateState.variables=[],this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.variables=e,a.privateState.isLoadingVars=!1,a.variables.value})).finally((function(){a.privateState.isLoadingVars=!1}))}},{key:"fetchAvailableVariables",value:function(e){return this.availableVariablesPromises[e]||(this.availableVariablesPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableVariableTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(o["readonly"])(e)}))),Promise.resolve(this.availableVariablesPromises[e])}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.variables.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===Ue(i))return i.v}}},{key:"createOrUpdateVariable",value:function(e,t,a,n,i){var o=this;this.privateState.isUpdating=!0;var l=Object.entries(i).map((function(e){var t=_e(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),c=Object.fromEntries(l),s=e.lookup_table.filter((function(e){return e&&e.out_value&&e.comparison}));return r["AjaxHelper"].post({idVariable:e.idvariable,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,defaultValue:e.default_value},{parameters:c,lookupTable:s},{withTokenInUrl:!0}).finally((function(){o.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.variables=[],this.fetchPromise=null,this.availableVariablesPromises={},this.fetchVariables(e,t)}},{key:"deleteVariable",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.variables=[],r["AjaxHelper"].fetch({idVariable:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVariable"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),We=new Re;function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ke(e,t,a){return t&&Xe(e.prototype,t),a&&Xe(e,a),e}function Ye(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Qe=function(){function e(){var t=this;ze(this,e),Ye(this,"privateState",Object(o["reactive"])({comparisons:[],isLoading:!1})),Ye(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Ye(this,"isLoading",Object(o["computed"])((function(){return t.state.value.isLoading}))),Ye(this,"comparisons",Object(o["computed"])((function(){return t.state.value.comparisons}))),Ye(this,"comparisonOptions",Object(o["computed"])((function(){return t.comparisons.value.map((function(e){var t=e.id,a=e.name;return{key:t,value:a}}))}))),this.fetchAvailableComparisons()}return Ke(e,[{key:"fetchAvailableComparisons",value:function(){var e=this;this.privateState.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getAvailableComparisons",filter_limit:"-1"}).then((function(t){e.privateState.comparisons=t})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Ze=Object(r["lazyInitSingleton"])(Qe),et="tagvariablemanagement",tt=Object(o["defineComponent"])({props:{idVariable:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variableType:String,isEmbedded:{type:Boolean,default:!1}},components:{GroupedSettings:g["GroupedSettings"],ContentBlock:r["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,showAdvanced:!1,chooseVariableType:!1,canUseCustomTemplates:r["Matomo"].hasUserCapability("tagmanager_use_custom_templates"),availableVariables:[],editTitle:"",variable:{},parameterValues:{},isUpdatingVar:!1}},emits:["changeVariable"],created:function(){We.fetchVariablesIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdVariable()},watch:{idVariable:function(e){null!==e&&this.initIdVariable()},variableParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0},variableLookupTable:{handler:function(){var e=(this.variable.lookup_table||[]).every((function(e){return!(null===e||void 0===e||!e.out_value)}));e&&this.addLookUpEntry()},deep:!0}},methods:{removeAnyVariableNotification:function(){r["NotificationsStore"].remove(et),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:et,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdVariable:function(){var e=this;r["Matomo"].helper.lazyScrollToContent(),this.availableVariables=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return We.fetchAvailableVariables(e.context)})).then((function(t){e.availableVariables=t})).then((function(){if(e.edit&&e.idVariable)return e.editTitle=Object(r["translate"])("TagManager_EditVariable"),void We.findVariable(e.idContainer,e.idContainerVersion,e.idVariable).then((function(t){t&&(e.variable=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),(e.variable.lookup_table&&e.variable.lookup_table.length||e.variable.default_value)&&(e.showAdvanced=!0),e.addLookUpEntryIfNoneExists(),e.isDirty=!1)}));if(e.create){var t=!1;e.variableType&&e.availableVariables.forEach((function(a){if(!t){var n=a.types.find((function(t){return(null===t||void 0===t?void 0:t.id)===e.variableType}));n&&(t=!0,e.createVariableType(n))}})),t||(e.editTitle=Object(r["translate"])("TagManager_ChooseVariableToContinue"),e.chooseVariableType=!0)}}))},addLookUpEntryIfNoneExists:function(){this.variable.lookup_table&&Array.isArray(this.variable.lookup_table)||(this.variable.lookup_table=[]),this.variable.lookup_table.length||this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""})},addLookUpEntry:function(){this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""}),this.isDirty=!0},removeLookUpEntry:function(e){e>-1&&(this.variable.lookup_table.splice(e,1),this.isDirty=!0)},createVariableType:function(e){var t=this;e&&this.isVariableTemplateDisabled[e.id]||(this.chooseVariableType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewVariable"),this.variable={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:We.suggestNameForType(e.name)||"",type:e.id,idcontainer:this.idContainer,idcontainerversion:this.idContainerVersion,default_value:"",lookup_table:[],typeMetadata:e},this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addLookUpEntry(),this.isDirty=!0,Object(o["nextTick"])((function(){if(t.$refs.root){var e=t.$refs.root;e.scrollIntoView();var a=e.querySelector("#name");a&&a.focus()}})))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idVariable,r["MatomoUrl"].updateHash(e)},createVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,We.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.addContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t){e.isDirty=!1;var a=t.value;We.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.variable.idvariable=a,void e.$emit("changeVariable",{variable:e.variable});r["Matomo"].helper.isAngularRenderingThePage()?r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:a})):r["MatomoUrl"].updateHash({idVariable:a}),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Variable")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))}})).finally((function(){e.isUpdatingVar=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,We.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.updateContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeVariable",{variable:e.variable});else{e.isDirty=!1,We.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdVariable()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Variable")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingVar=!1})))},checkRequiredFieldsAreSet:function(){return!!this.variable.name||(this.showErrorFieldNotProvidedNotification(Object(r["translate"])("General_Name")),!1)}},computed:{typeInlineHelp:function(){var e,t,a=(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.description)||"",n=(null===(t=this.variable.typeMetadata)||void 0===t?void 0:t.help)||"";return"".concat(a," ").concat(n)},create:function(){return 0===this.idVariable},edit:function(){return!this.create},isLoading:function(){return We.isLoading.value||Ze.isLoading.value},isUpdating:function(){return We.isUpdating.value||this.isUpdatingVar},availableLookUpComparisons:function(){return Ze.comparisonOptions.value},isVariableTemplateDisabled:function(){var e=this,t={};return this.availableVariables.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},isVariableDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},variableParameterValues:function(){var e;return null!==(e=this.variable.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null},variableLookupTable:function(){return this.variable.lookup_table}}});tt.render=Me;var at=tt,nt=(Object(r["createAngularJsAdapter"])({component:at,scope:{idVariable:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},variableType:{angularJsBind:"=?"},isEmbedded:{default:function(e){return!!e.onChangeVariable}},onChangeVariable:{angularJsBind:"&?",vue:"changeVariable"}},directiveName:"piwikVariableEdit",events:{onChangeVariable:function(e,t,a){a.idVariable=e.variable.idvariable}},postCreate:function(e,t){t.$on("$destroy",(function(){t.idVariable=null}))}}),{class:"tagManagerManageList tagManagerVariableList"}),it={class:"name"},rt={class:"type"},ot={class:"lookupTable"},lt={class:"lastUpdated"},ct={colspan:"7"},st={class:"loadingPiwik"},dt=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),ut={colspan:"7"},gt=["id"],bt={class:"name"},mt=["title"],pt={class:"lookupTable"},ft={class:"icon-ok"},ht=["title"],vt={class:"action"},jt=["onClick","title"],Ot=["onClick","title"],Tt={class:"tableActionBar"},Vt=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),yt=["title"],Ct=Object(o["createElementVNode"])("span",{class:"icon-help preconfiguredVariablesHelp"},null,-1),Nt={class:"collection-header"},Et={class:"title"},wt=["textContent"],St={class:"secondary-content"},kt=["title"],Mt={class:"ui-confirm",id:"confirmDeleteVariable",ref:"confirmDeleteVariable"},_t=["value"],Dt=["value"],At={class:"ui-confirm",id:"confirmDeleteVariableNotPossible",ref:"confirmDeleteVariableNotPossible"},Bt={class:"collection"},Ut=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Lt(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ContentBlock"),c=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",nt,[Object(o["createVNode"])(l,{feature:"Tag Manager",class:"tagManagerCustomVariablesList","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Variables"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",it,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",rt,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",ot,Object(o["toDisplayString"])(e.translate("TagManager_LookupTable")),1),Object(o["createElementVNode"])("th",lt,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",ct,[Object(o["createElementVNode"])("span",st,[dt,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",ut,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoVariablesFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerVariableNow",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariableNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&!e.variables.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedVariables,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{id:"variable".concat(t.idvariable),class:"variables",key:t.idvariable},[Object(o["createElementVNode"])("td",bt,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,mt),Object(o["createElementVNode"])("td",pt,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",ft,null,512),[[o["vShow"],t.lookup_table.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,ht),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",vt,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editVariable(t.idvariable,t.type)},title:e.translate("TagManager_EditVariable")},null,8,jt),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteVariable(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Variable"))},null,8,Ot)],512),[[o["vShow"],e.hasWriteAccess]])],8,gt)})),128))])],512),[[c]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Tt,[Object(o["createElementVNode"])("a",{class:"createNewVariable",value:"",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[Vt,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("h2",{title:e.translate("TagManager_PreConfiguredInfoTitle")},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables"))+" ",1),Ct],8,yt),Object(o["createElementVNode"])("div",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.containerVariables,(function(e,t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t},[Object(o["createElementVNode"])("li",Nt,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(e.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.types,(function(e){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:e.id},[Object(o["createElementVNode"])("span",Et,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.name)+" ",1),Object(o["createElementVNode"])("span",{class:"variableId",textContent:Object(o["toDisplayString"])("{{".concat(e.id,"}}"))},null,8,wt)]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",St,[Object(o["createElementVNode"])("i",{class:"icon-help",title:e.description},null,8,kt)],512),[[o["vShow"],!!e.description]])],512)),[[o["vShow"],e.is_pre_configured]])})),128))])})),128))]),Object(o["createElementVNode"])("div",Mt,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteVariableConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,_t),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Dt)],512),Object(o["createElementVNode"])("div",At,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableCannotBeDeleted")),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedBy")),1),Object(o["createElementVNode"])("ul",Bt,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.variableReferences,(function(e){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:"".concat(e.referenceType,".").concat(e.referenceId)},Object(o["toDisplayString"])(e.referenceTypeName)+": "+Object(o["toDisplayString"])(e.referenceName),1)})),128))]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_VariableBeingUsedNeedsRemove")),1),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,Ut)],512)])}function xt(e){return Ht(e)||Ft(e)||Pt(e)||It()}function It(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pt(e,t){if(e){if("string"===typeof e)return qt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?qt(e,t):void 0}}function Ft(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ht(e){if(Array.isArray(e))return qt(e)}function qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var $t=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write"),variableReferences:[],containerVariables:[]}},created:function(){var e=this;We.fetchVariables(this.idContainer,this.idContainerVersion),r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerVariables=t}))},methods:{createVariable:function(){this.editVariable(0)},editVariable:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idVariable:e}))},deleteVariable:function(e){var t=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerVariableReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idVariable:e.idvariable}).then((function(a){a&&a.length?(t.variableReferences=a,r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariableNotPossible,{})):(t.variableReferences=[],r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariable,{yes:function(){We.deleteVariable(t.idContainer,t.idContainerVersion,e.idvariable).then((function(){We.reload(t.idContainer,t.idContainerVersion)}))}}))}))}},computed:{isLoading:function(){return We.isLoading.value},isUpdating:function(){return We.isUpdating.value},variables:function(){return We.variables.value},sortedVariables:function(){var e=xt(this.variables);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});$t.render=Lt;var Gt=$t,Jt=(Object(r["createAngularJsAdapter"])({component:Gt,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikVariableList"}),{class:"manageVariable"}),Rt={key:0},Wt={key:1};
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function zt(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableList"),c=Object(o["resolveComponent"])("VariableEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Jt,[e.editMode?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Rt,[Object(o["createVNode"])(l,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer},null,8,["id-container-version","id-container"])])),e.editMode?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Wt,[Object(o["createVNode"])(c,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"id-variable":e.idVariable},null,8,["id-container-version","id-container","id-variable"])])):Object(o["createCommentVNode"])("",!0)])}var Xt=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{VariableList:Gt,VariableEdit:at},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idVariable}),(function(t){e.onIdVariableParamChange(t)})),r["NotificationsStore"].remove("variablevariablemanagement"),this.onIdVariableParamChange(r["MatomoUrl"].hashParsed.value.idVariable)},methods:{onIdVariableParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddVariable",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idVariable:function(){var e=r["MatomoUrl"].hashParsed.value.idVariable;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idVariable}}});Xt.render=zt;var Kt=Xt;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:Kt,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return e?parseInt(e,10):void 0}},idContainer:{angularJsBind:"@"}},directiveName:"piwikVariableManage"});function Yt(e,t){return ea(e)||Zt(e,t)||ia(e,t)||Qt()}function Qt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Zt(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function ea(e){if(Array.isArray(e))return e}function ta(e){return ta="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ta(e)}function aa(e){return oa(e)||ra(e)||ia(e)||na()}function na(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ia(e,t){if(e){if("string"===typeof e)return la(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?la(e,t):void 0}}function ra(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function oa(e){if(Array.isArray(e))return la(e)}function la(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ca(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function da(e,t,a){return t&&sa(e.prototype,t),a&&sa(e,a),e}function ua(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var ga=function(){function e(){var t=this;ca(this,e),ua(this,"privateState",Object(o["reactive"])({triggers:[],isLoadingTriggers:!1,isLoadingSingle:!1,isUpdating:!1})),ua(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),ua(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),ua(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingTriggers||e.isLoadingSingle}))),ua(this,"triggers",Object(o["computed"])((function(){return t.state.value.triggers}))),ua(this,"fetchPromise",null),ua(this,"availableTriggersPromises",{})}return da(e,[{key:"fetchTriggers",value:function(e,t){var a=this;return this.privateState.triggers=[],this.privateState.isLoadingTriggers=!0,this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.triggers=e,a.triggers.value})).finally((function(){a.privateState.isLoadingTriggers=!1}))}},{key:"fetchTriggersIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchTriggers(e,t)}},{key:"fetchAvailableTriggers",value:function(e){return this.availableTriggersPromises[e]||(this.availableTriggersPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableTriggerTypesInContext",idContext:e,filter_limit:"-1"})),Promise.resolve(this.availableTriggersPromises[e])}},{key:"findTrigger",value:function(e,t,a){var n=this,i=this.triggers.value.find((function(e){return e.idtrigger===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idTrigger:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTrigger",filter_limit:"-1"}).then((function(e){return n.privateState.triggers=[].concat(aa(n.privateState.triggers),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.triggers.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===ta(i))return i.v}}},{key:"createOrUpdateTrigger",value:function(e,t,a,n,i){var o=this,l=Object.entries(i).map((function(e){var t=Yt(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),c=Object.fromEntries(l),s=e.conditions.filter((function(e){return e&&e.actual&&e.comparison&&e.expected}));return this.privateState.isUpdating=!0,r["AjaxHelper"].post({idTrigger:e.idtrigger,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name},{parameters:c,conditions:s},{withTokenInUrl:!0}).finally((function(){o.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.triggers=[],this.fetchPromise=null,this.availableTriggersPromises={},this.fetchTriggers(e,t)}},{key:"deleteTrigger",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.triggers=[],r["AjaxHelper"].fetch({idTrigger:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTrigger"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),ba=new ga;function ma(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */
window.angular.module("piwikApp").factory("tagManagerTriggerModel",(function(){return ba}));var pa={class:"editTrigger tagManagerManageEdit",ref:"root"},fa={class:"loadingPiwik"},ha=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),va={class:"loadingPiwik"},ja=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Oa={class:"form-group row"},Ta={class:"col s12"},Va={key:0},ya={class:"form-group row"},Ca={class:"col s12"},Na={class:"form-group row multiple"},Ea={class:"col s12 m12"},wa={class:"innerFormField"},Sa={class:"innerFormField comparisonField"},ka={class:"innerFormField"},Ma=["onClick","title"],_a={class:"triggerConditionNode"},Da={class:"entityCancel"},Aa={id:"confirmSelectTriggerType"},Ba={class:"collection-header"},Ua=["onClick","title"],La=["src"],xa={class:"title"},Ia={class:"secondary-content"},Pa=["title"],Fa={class:"entityCancel"};function Ha(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field"),c=Object(o["resolveComponent"])("GroupedSettings"),s=Object(o["resolveComponent"])("SaveButton"),d=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",pa,[Object(o["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,d,u,g,b;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",fa,[ha,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",va,[ja,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[4]||(t[4]=function(t){return e.edit?e.updateTrigger():e.createTrigger()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTriggerDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"type","model-value":null===(a=e.trigger.typeMetadata)||void 0===a?void 0:a.name,disabled:!0,"inline-help":"".concat(null===(n=e.trigger.typeMetadata)||void 0===n?void 0:n.description," ").concat(null===(i=e.trigger.typeMetadata)||void 0===i?void 0:i.help),title:e.translate("TagManager_Type")},null,8,["model-value","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.trigger.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.trigger.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TriggerNameHelp")},null,8,["model-value","title","inline-help"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Oa,[Object(o["createElementVNode"])("div",Ta,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureThisTrigger")),1)])],512),[[o["vShow"],null===(r=e.trigger.typeMetadata)||void 0===r||null===(d=r.parameters)||void 0===d?void 0:d.length]]),e.trigger?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Va,[Object(o["createVNode"])(c,{settings:(null===(u=e.trigger.typeMetadata)||void 0===u?void 0:u.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[1]||(t[1]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",ya,[Object(o["createElementVNode"])("div",Ca,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_OnlyTriggerWhen"))+" "+Object(o["toDisplayString"])(e.translate("Goals_Optional")),1)])],512),[[o["vShow"],null===(g=e.trigger.typeMetadata)||void 0===g?void 0:g.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",Na,[Object(o["createElementVNode"])("div",Ea,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerConditionsHelp")),1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.trigger.conditions,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{key:a,class:Object(o["normalizeClass"])(["condition multiple valign-wrapper","condition".concat(a)])},[Object(o["createElementVNode"])("div",wa,[Object(o["createVNode"])(l,{uicontrol:"expandable-select",name:"condition_actual","model-value":t.actual,"onUpdate:modelValue":function(a){t.actual=a,e.setValueHasChanged()},"full-width":!0,options:e.availableVariables,title:e.variableIdToName[t.actual]||t.actual},null,8,["model-value","onUpdate:modelValue","options","title"])]),Object(o["createElementVNode"])("div",Sa,[Object(o["createVNode"])(l,{uicontrol:"select",name:"condition_comparison","model-value":t.comparison,"onUpdate:modelValue":function(a){t.comparison=a,e.setValueHasChanged()},"full-width":!0,options:e.availableComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(o["createElementVNode"])("div",ka,[Object(o["createVNode"])(l,{uicontrol:"text",name:"condition_expected","model-value":t.expected,"onUpdate:modelValue":function(a){t.expected=a,e.setValueHasChanged(),e.onConditionChange()},"full-width":!0},null,8,["model-value","onUpdate:modelValue"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"icon-minus valign",onClick:function(t){return e.removeConditionEntry(a)},title:e.translate("General_Remove")},null,8,Ma),[[o["vShow"],!(a+1===e.trigger.conditions.length)]])],2)})),128))]),Object(o["createElementVNode"])("p",_a,Object(o["toDisplayString"])(e.translate("TagManager_TriggerConditionNode")),1)])])],512),[[o["vShow"],null===(b=e.trigger.typeMetadata)||void 0===b?void 0:b.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTriggerDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(s,{class:"createButton",onConfirm:t[2]||(t[2]=function(t){return e.edit?e.updateTrigger():e.createTrigger()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isTriggerDisabled]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Da,[Object(o["createElementVNode"])("a",{onClick:t[3]||(t[3]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])])],544),[[o["vShow"],!e.chooseTriggerType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Aa,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableTriggers,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:a},[Object(o["createElementVNode"])("li",Ba,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:Object(o["normalizeClass"])(["collection-item avatar",ma({disabledTemplate:e.isTriggerTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createTriggerType(t)},key:a,title:e.isTriggerTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,La)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",xa,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Ia,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Pa)],512),[[o["vShow"],!!t.help]])],10,Ua)})),128))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Fa,[Object(o["createElementVNode"])("a",{onClick:t[5]||(t[5]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[o["vShow"],!e.isEmbedded]])],512),[[o["vShow"],e.chooseTriggerType]])]})),_:1},8,["content-title"])],512)}var qa="tagvariablemanagement",$a={AllElementsClick:"ClickId",AllLinksClick:"ClickId",DownloadClick:"ClickId",ElementVisibility:"VisibleElementClasses",FormSubmit:"FormId",JavaScriptError:"ErrorMessage"},Ga=Object(o["defineComponent"])({props:{idTrigger:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTriggerType:String,isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:r["ContentBlock"],Field:g["Field"],GroupedSettings:g["GroupedSettings"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,chooseTriggerType:!1,availableTriggers:[],availableVariables:[],variableIdToName:{},editTitle:"",trigger:{},parameterValues:{},isUpdatingTrigger:!1}},emits:["changeTrigger"],created:function(){var e=this;r["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion}).then((function(t){t.forEach((function(t){t.types.forEach((function(a){e.variableIdToName[a.id]=a.name,e.availableVariables.push({key:a.id,value:a.name,group:t.name})}))}))})),ba.fetchTriggersIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdTrigger()},watch:{idTrigger:function(e){null!==e&&this.initIdTrigger()},triggerParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0}},methods:{checkRequiredFieldsAreSet:function(){return!!this.trigger.name||(this.showErrorFieldNotProvidedNotification(Object(r["translate"])("General_Name")),!1)},removeAnyTriggerNotification:function(){r["NotificationsStore"].remove(qa),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:qa,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTrigger:function(){var e=this;this.trigger={},this.chooseTriggerType=!1,this.editTitle="",r["Matomo"].helper.lazyScrollToContent(),this.availableTriggers=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return ba.fetchAvailableTriggers(e.context)})).then((function(t){e.availableTriggers=t})).then((function(){if(e.edit&&e.idTrigger)return e.editTitle=Object(r["translate"])("TagManager_EditTrigger"),void ba.findTrigger(e.idContainer,e.idContainerVersion,e.idTrigger).then((function(t){t&&(e.trigger=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),e.addConditionEntryIfNoneExists(),e.onConditionChange(),e.isDirty=!1)}));e.create&&(e.editTitle=Object(r["translate"])("TagManager_ChooseTriggerToContinue"),e.chooseTriggerType=!0)}))},onConditionChange:function(){var e=(this.trigger.conditions||[]).every((function(e){return!(null===e||void 0===e||!e.expected)}));e&&this.addConditionEntry()},addConditionEntryIfNoneExists:function(){this.trigger.conditions&&Array.isArray(this.trigger.conditions)||(this.trigger.conditions=[]),this.trigger.conditions.length||this.trigger.conditions.push(this.makeDefaultCondition())},addConditionEntry:function(){this.trigger.conditions.push(this.makeDefaultCondition()),this.isDirty=!0},removeConditionEntry:function(e){if(e>-1){var t=this.trigger.conditions.length-1;t===e?this.trigger.conditions[e]=this.makeDefaultCondition():this.trigger.conditions.splice(e,1),this.isDirty=!0}},createTriggerType:function(e){var t=this;e&&this.isTriggerTemplateDisabled[e.id]||(this.chooseTriggerType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewTrigger"),this.trigger={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:ba.suggestNameForType(e.name)||"",type:e.id,idcontainerversion:this.idContainerVersion,conditions:[],typeMetadata:e},this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addConditionEntry(),this.isDirty=!0,Object(o["nextTick"])((function(){if(t.$refs.root){var e=t.$refs.root;e.scrollIntoView();var a=e.querySelector("#name");a&&a.focus()}})))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idTrigger,r["MatomoUrl"].updateHash(e)},createTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ba.createOrUpdateTrigger(this.trigger,"TagManager.addContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){var a=t.value;e.isDirty=!1,ba.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.trigger.idtrigger=a,void e.$emit("changeTrigger",{trigger:e.trigger});r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTrigger:a})),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Trigger")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a href="" class="createNewVersionLink">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))})).finally((function(){e.isUpdatingTrigger=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ba.createOrUpdateTrigger(this.trigger,"TagManager.updateContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeTrigger",{trigger:e.trigger});else{e.isDirty=!1,ba.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdTrigger()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Trigger")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a href="" class="createNewVersionLink">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingTrigger=!1})))},makeDefaultCondition:function(){var e,t="PageUrl";if(null!==(e=this.trigger)&&void 0!==e&&e.typeMetadata){var a=this.trigger.typeMetadata.id;$a[a]&&(t=$a[a])}return{comparison:"equals",actual:t,expected:""}}},computed:{isLoading:function(){return ba.isLoading.value||Ze.isLoading.value},isUpdating:function(){return ba.isUpdating.value||this.isUpdatingTrigger},create:function(){return 0===this.idTrigger},edit:function(){return!this.create},canUseCustomTemplates:function(){return r["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTriggerDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.trigger.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},saveButtonText:function(){return this.edit?Object(r["translate"])("CoreUpdater_UpdateTitle"):Object(r["translate"])("TagManager_CreateNewTrigger")},collectionItemAvatarText:function(){return Object(r["translate"])("TagManager_UseCustomTemplateCapabilityRequired",Object(r["translate"])("TagManager_CapabilityUseCustomTemplates"))},availableComparisons:function(){return Ze.comparisonOptions.value},isTriggerTemplateDisabled:function(){var e=this,t={};return this.availableTriggers.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},triggerParameterValues:function(){var e;return null!==(e=this.trigger.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null}}});Ga.render=Ha;var Ja=Ga,Ra=(Object(r["createAngularJsAdapter"])({component:Ja,scope:{idTrigger:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},newTriggerType:{angularJsBind:"="},isEmbedded:{default:function(e){return!!e.onChangeTrigger}},onChangeTrigger:{angularJsBind:"&?",vue:"changeTrigger"}},directiveName:"piwikTriggerEdit",events:{onChangeTrigger:function(e,t,a){a.idTrigger=e.trigger.idtrigger}},postCreate:function(e,t){t.$on("$destroy",(function(){t.idTrigger=null}))}}),{class:"tagManagerManageList tagManagerTriggerList"}),Wa={class:"name"},za={class:"type"},Xa={class:"conditions"},Ka={class:"lastUpdated"},Ya={colspan:"7"},Qa={class:"loadingPiwik"},Za=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),en={colspan:"7"},tn=["id"],an={class:"name"},nn=["title"],rn={class:"conditions"},on={class:"icon-ok"},ln=["title"],cn={class:"action"},sn=["onClick","title"],dn=["onClick","title"],un={class:"tableActionBar"},gn=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),bn={class:"ui-confirm",id:"confirmDeleteTrigger",ref:"confirmDeleteTrigger"},mn=["value"],pn=["value"],fn={class:"ui-confirm",id:"confirmDeleteTriggerNotPossible",ref:"confirmDeleteTriggerNotPossible"},hn={class:"collection"},vn=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function jn(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("ContentBlock"),c=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Ra,[Object(o["createVNode"])(l,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Triggers"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",Wa,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",za,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",Xa,Object(o["toDisplayString"])(e.translate("TagManager_Filter")),1),Object(o["createElementVNode"])("th",Ka,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Ya,[Object(o["createElementVNode"])("span",Qa,[Za,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",en,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerTriggerNow",onClick:t[0]||(t[0]=function(t){return e.createTrigger()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&0===e.triggers.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedTriggers,(function(t){var a;return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{id:"trigger".concat(t.idtrigger),class:"triggers",key:t.idtrigger},[Object(o["createElementVNode"])("td",an,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,nn),Object(o["createElementVNode"])("td",rn,[Object(o["withDirectives"])(Object(o["createElementVNode"])("span",on,null,512),[[o["vShow"],null===(a=t.conditions)||void 0===a?void 0:a.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,ln),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",cn,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editTrigger(t.idtrigger,t.type)},title:e.translate("TagManager_EditTrigger")},null,8,sn),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteTrigger(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Trigger"))},null,8,dn)],512),[[o["vShow"],e.hasWriteAccess]])],8,tn)})),128))])],512),[[c]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",un,[Object(o["createElementVNode"])("a",{class:"createNewTrigger",value:"",onClick:t[1]||(t[1]=function(t){return e.createTrigger()})},[gn,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",bn,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteTriggerConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,mn),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,pn)],512),Object(o["createElementVNode"])("div",fn,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerCannotBeDeleted")),1),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedBy")),1),Object(o["createElementVNode"])("ul",hn,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.triggerReferences,(function(e){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{class:"collection-item",key:e.referenceId},Object(o["toDisplayString"])(e.referenceTypeName)+": "+Object(o["toDisplayString"])(e.referenceName),1)})),128))]),Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedNeedsRemove")),1),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,vn)],512)])}function On(e){return Cn(e)||yn(e)||Vn(e)||Tn()}function Tn(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Vn(e,t){if(e){if("string"===typeof e)return Nn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Nn(e,t):void 0}}function yn(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Cn(e){if(Array.isArray(e))return Nn(e)}function Nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var En=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write"),triggerReferences:[]}},created:function(){ba.fetchTriggers(this.idContainer,this.idContainerVersion)},methods:{createTrigger:function(){this.editTrigger(0)},editTrigger:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTrigger:e}))},deleteTrigger:function(e){var t=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerTriggerReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idTrigger:e.idtrigger}).then((function(a){if(a&&a.length)t.triggerReferences=a,r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTriggerNotPossible,{});else{t.triggerReferences=[];var n=function(){ba.deleteTrigger(t.idContainer,t.idContainerVersion,e.idtrigger).then((function(){ba.reload(t.idContainer,t.idContainerVersion)}))};r["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTrigger,{yes:n})}}))}},computed:{isLoading:function(){return ba.isLoading.value},isUpdating:function(){return ba.isUpdating.value},triggers:function(){return ba.triggers.value},sortedTriggers:function(){var e=On(this.triggers);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});En.render=jn;var wn=En,Sn=(Object(r["createAngularJsAdapter"])({component:wn,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikTriggerList"}),{class:"manageTrigger"});
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function kn(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("TriggerList"),c=Object(o["resolveComponent"])("TriggerEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Sn,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion},null,8,["id-container","id-container-version"])])],512),[[o["vShow"],!e.editMode]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-trigger":e.idTrigger},null,8,["id-container","id-container-version","id-trigger"])])],512),[[o["vShow"],e.editMode]])])}var Mn=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{TriggerList:wn,TriggerEdit:Ja},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idTrigger}),(function(t){e.onIdTriggerParamChange(t)})),r["NotificationsStore"].remove("triggertriggermanagement"),this.onIdTriggerParamChange(r["MatomoUrl"].hashParsed.value.idTrigger)},methods:{onIdTriggerParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddTrigger",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idTrigger:function(){var e=r["MatomoUrl"].hashParsed.value.idTrigger;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idTrigger}}});Mn.render=kn;var _n=Mn;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(r["createAngularJsAdapter"])({component:_n,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return"string"===typeof e?parseInt(e,10):e}},idContainer:{angularJsBind:"@"}},directiveName:"piwikTriggerManage"});function Dn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var An={class:"editTag tagManagerManageEdit",ref:"root"},Bn={class:"loadingPiwik"},Un=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Ln={class:"loadingPiwik"},xn=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),In={class:"form-group row"},Pn={class:"col s12"},Fn={key:0},Hn={class:"form-group row"},qn={class:"col s12"},$n={class:"form-group row"},Gn={class:"col s12"},Jn={class:"form-group row tagStartDate"},Rn={class:"col s12 m6"},Wn={class:"row"},zn={class:"col s12"},Xn={for:"start_date_date",class:"active"},Kn={class:"tagStartDate"},Yn={class:"col s12 m6 "},Qn={class:"form-help"},Zn={class:"inline-help"},ei=["innerHTML"],ti=Object(o["createElementVNode"])("br",null,null,-1),ai=["innerHTML"],ni={class:"form-group row tagEndDate"},ii={class:"col s12 m6"},ri={class:"row"},oi={class:"col s12"},li={for:"end_date_date",class:"active"},ci={class:"tagEndDate"},si={class:"col s12 m6"},di={class:"form-help"},ui={class:"inline-help"},gi=["innerHTML"],bi=Object(o["createElementVNode"])("br",null,null,-1),mi=["innerHTML"],pi={class:"entityCancel"},fi={id:"confirmSelectTagType"},hi={class:"collection-header"},vi=["onClick","title"],ji=["src"],Oi={class:"title"},Ti={class:"secondary-content"},Vi=["title"],yi={class:"entityCancel"};function Ci(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field"),c=Object(o["resolveComponent"])("GroupedSettings"),s=Object(o["resolveComponent"])("TagTriggerArray"),d=Object(o["resolveComponent"])("TagDateInput"),u=Object(o["resolveComponent"])("SaveButton"),g=Object(o["resolveComponent"])("ContentBlock");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",An,[Object(o["createVNode"])(g,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(o["withCtx"])((function(){var a,n,i,r,g,b,m,p;return[Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",Bn,[Un,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[o["vShow"],e.isLoading]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Object(o["createElementVNode"])("span",Ln,[xn,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[o["vShow"],e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("form",{onSubmit:t[17]||(t[17]=function(t){return e.edit?e.updateTag():e.createTag()})},[Object(o["createElementVNode"])("div",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTagDisabled]]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"type","model-value":null===(a=e.tag.typeMetadata)||void 0===a?void 0:a.name,disabled:!0,"inline-help":(null===(n=e.tag.typeMetadata)||void 0===n?void 0:n.description)+" "+(null===(i=e.tag.typeMetadata)||void 0===i?void 0:i.help),title:e.translate("TagManager_Type")},null,8,["model-value","inline-help","title"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.tag.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.tag.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TagNameHelp")},null,8,["model-value","title","inline-help"])]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",In,[Object(o["createElementVNode"])("div",Pn,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureWhatTagDoes")),1)])],512),[[o["vShow"],null===(r=e.tag.typeMetadata)||void 0===r?void 0:r.parameters.length]]),e.tag?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Fn,[Object(o["createVNode"])(c,{settings:(null===(g=e.tag.typeMetadata)||void 0===g?void 0:g.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[1]||(t[1]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(o["createCommentVNode"])("",!0),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",Hn,[Object(o["createElementVNode"])("div",qn,[Object(o["createElementVNode"])("h3",null,Object(o["toDisplayString"])(e.translate("TagManager_ConfigureWhenTagDoes")),1)])],512),[[o["vShow"],null===(b=e.tag.typeMetadata)||void 0===b?void 0:b.parameters.length]]),Object(o["createVNode"])(s,{"container-triggers":e.containerTriggers,type:"fire",title:e.translate("TagManager_FireTriggerTitle"),help:e.translate("TagManager_FireTriggerHelp",e.translate("TagManager_FireLimit")),"model-value":e.fireTriggers,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.fireTriggers=t,e.setValueHasChanged(),e.onFireTriggerChange()}),onCreate:t[3]||(t[3]=function(t){return e.onCreateNewFireTrigger()}),onEdit:t[4]||(t[4]=function(t){return e.editTrigger(t)})},null,8,["container-triggers","title","help","model-value"]),Object(o["createVNode"])(s,{"container-triggers":e.containerTriggers,type:"block",title:e.translate("TagManager_BlockTriggerTitle"),help:e.translate("TagManager_BlockTriggerHelp"),"model-value":e.blockTriggers,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.blockTriggers=t,e.setValueHasChanged(),e.onBlockTriggerChange()}),onCreate:t[6]||(t[6]=function(t){return e.onCreateNewBlockTrigger()}),onEdit:t[7]||(t[7]=function(t){return e.editTrigger(t)})},null,8,["container-triggers","title","help","model-value"]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",$n,[Object(o["createElementVNode"])("div",Gn,[Object(o["createElementVNode"])("h3",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{href:"",class:"showAdvancedSettings",onClick:t[8]||(t[8]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[o["vShow"],!e.showAdvanced]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{href:"",class:"hideAdvancedSettings",onClick:t[9]||(t[9]=Object(o["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(o["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[o["vShow"],e.showAdvanced]])])])],512),[[o["vShow"],null===(m=e.tag.typeMetadata)||void 0===m?void 0:m.hasAdvancedSettings]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"radio",name:"fire_limit","model-value":e.tag.fire_limit,"onUpdate:modelValue":t[10]||(t[10]=function(t){e.tag.fire_limit=t,e.setValueHasChanged()}),options:e.availableFireLimits,title:e.translate("TagManager_FireLimit"),"inline-help":e.fireLimitHelp},null,8,["model-value","options","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"fire_delay","model-value":e.tag.fire_delay,"onUpdate:modelValue":t[11]||(t[11]=function(t){e.tag.fire_delay=t,e.setValueHasChanged()}),maxlength:8,title:e.translate("TagManager_FireDelay"),"inline-help":e.translate("TagManager_FireDelayHelp")},null,8,["model-value","title","inline-help"])]),Object(o["createElementVNode"])("div",null,[Object(o["createVNode"])(l,{uicontrol:"text",name:"priority","model-value":e.tag.priority,"onUpdate:modelValue":t[12]||(t[12]=function(t){e.tag.priority=t,e.setValueHasChanged()}),maxlength:4,title:e.translate("TagManager_Priority"),"inline-help":e.translate("TagManager_PriorityHelp")},null,8,["model-value","title","inline-help"])]),Object(o["createElementVNode"])("div",Jn,[Object(o["createElementVNode"])("div",Rn,[Object(o["createElementVNode"])("div",Wn,[Object(o["createElementVNode"])("div",zn,[Object(o["createElementVNode"])("label",Xn,Object(o["toDisplayString"])(e.translate("TagManager_StartDate"))+":",1)]),Object(o["createElementVNode"])("div",Kn,[Object(o["createVNode"])(d,{name:"start_date","model-value":e.tag.start_date,"onUpdate:modelValue":t[13]||(t[13]=function(t){e.tag.start_date=t,e.setValueHasChanged()}),"default-time":"00:00:00"},null,8,["model-value"])])])]),Object(o["createElementVNode"])("div",Yn,[Object(o["createElementVNode"])("div",Qn,[Object(o["createElementVNode"])("span",Zn,[Object(o["createElementVNode"])("span",null,[Object(o["createElementVNode"])("span",{innerHTML:e.translate("TagManager_TagStartDateHelp","<strong>","</strong>")},null,8,ei),ti,Object(o["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>")},null,8,ai)])])])])]),Object(o["createElementVNode"])("div",ni,[Object(o["createElementVNode"])("div",ii,[Object(o["createElementVNode"])("div",ri,[Object(o["createElementVNode"])("div",oi,[Object(o["createElementVNode"])("label",li,Object(o["toDisplayString"])(e.translate("TagManager_EndDate"))+":",1)]),Object(o["createElementVNode"])("div",ci,[Object(o["createVNode"])(d,{name:"end_date","model-value":e.tag.end_date,"onUpdate:modelValue":t[14]||(t[14]=function(t){e.tag.end_date=t,e.setValueHasChanged()}),"default-time":"23:59:59"},null,8,["model-value"])])])]),Object(o["createElementVNode"])("div",si,[Object(o["createElementVNode"])("div",di,[Object(o["createElementVNode"])("span",ui,[Object(o["createElementVNode"])("span",null,[Object(o["createElementVNode"])("span",{innerHTML:e.translate("TagManager_TagEndDateHelp","<strong>","</strong>")},null,8,gi),bi,Object(o["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>")},null,8,mi)])])])])])],512),[[o["vShow"],e.showAdvanced&&(null===(p=e.tag.typeMetadata)||void 0===p?void 0:p.hasAdvancedSettings)]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",{class:"alert alert-warning"},Object(o["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[o["vShow"],e.isTagDisabled]]),Object(o["withDirectives"])(Object(o["createVNode"])(u,{class:"createButton",onConfirm:t[15]||(t[15]=function(t){return e.edit?e.updateTag():e.createTag()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewTag")},null,8,["disabled","saving","value"]),[[o["vShow"],!e.isTagDisabled]]),Object(o["createElementVNode"])("div",pi,[Object(o["createElementVNode"])("a",{onClick:t[16]||(t[16]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)])])],544),[[o["vShow"],!e.chooseTagType&&e.editTitle]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",fi,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.availableTags,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(o["createElementVNode"])("li",hi,[Object(o["createElementVNode"])("h4",null,Object(o["toDisplayString"])(t.name),1)]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.types,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{key:a,class:Object(o["normalizeClass"])(["collection-item avatar",Dn({disabledTemplate:e.isTagTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(a){return e.createTagType(t)},title:e.isTagTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(o["openBlock"])(),Object(o["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,ji)):Object(o["createCommentVNode"])("",!0),Object(o["createElementVNode"])("span",Oi,Object(o["toDisplayString"])(t.name),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(t.description),513),[[o["vShow"],t.description]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",Ti,[Object(o["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Vi)],512),[[o["vShow"],!!t.help]])],10,vi)})),128))])})),128)),Object(o["createElementVNode"])("div",yi,[Object(o["createElementVNode"])("a",{onClick:t[18]||(t[18]=function(t){return e.cancel()})},Object(o["toDisplayString"])(e.translate("General_Cancel")),1)])],512),[[o["vShow"],e.chooseTagType]])]})),_:1},8,["content-title"])],512)}function Ni(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ei(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wi(e,t,a){return t&&Ei(e.prototype,t),a&&Ei(e,a),e}function Si(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var ki=function(){function e(){var t=this;Ni(this,e),Si(this,"privateState",Object(o["reactive"])({fireLimits:[],isLoading:!1})),Si(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Si(this,"isLoading",Object(o["computed"])((function(){return t.state.value.isLoading}))),Si(this,"fireLimits",Object(o["computed"])((function(){return t.state.value.fireLimits}))),Si(this,"fireLimitsOptions",Object(o["computed"])((function(){return t.fireLimits.value.map((function(e){var t=e.id,a=e.name;return{key:t,value:a}}))}))),this.fetchAvailableComparisons()}return wi(e,[{key:"fetchAvailableComparisons",value:function(){var e=this;this.privateState.isLoading=!0,r["AjaxHelper"].fetch({method:"TagManager.getAvailableTagFireLimits",filter_limit:"-1"}).then((function(t){e.privateState.fireLimits=t})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Mi=Object(r["lazyInitSingleton"])(ki),_i={class:"col s12 m6"},Di=["for"],Ai=Object(o["createElementVNode"])("br",null,null,-1),Bi=["name"],Ui=["onClick","title"],Li=["onClick","title"],xi={class:"col s12 m6"},Ii={class:"form-help"},Pi={class:"inline-help"},Fi=Object(o["createElementVNode"])("br",null,null,-1),Hi=Object(o["createElementVNode"])("br",null,null,-1);function qi(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("Field");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{class:Object(o["normalizeClass"])(["form-group row","".concat(e.type,"Triggers")])},[Object(o["createElementVNode"])("div",_i,[Object(o["createElementVNode"])("div",null,[Object(o["createElementVNode"])("label",{for:"".concat(e.type,"_triggers")},Object(o["toDisplayString"])(e.title),9,Di),Object(o["withDirectives"])(Object(o["createElementVNode"])("p",null,[Ai,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+". ",1),Object(o["createElementVNode"])("a",{class:"createNewTrigger",onClick:t[0]||(t[0]=function(t){return e.$emit("create")})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)],512),[[o["vShow"],0===e.containerTriggers.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.modelValue,(function(t,a){return Object(o["withDirectives"])((Object(o["openBlock"])(),Object(o["createElementBlock"])("div",{class:Object(o["normalizeClass"])(["multiple valign-wrapper","".concat(e.type,"Trigger ").concat(e.type,"Trigger").concat(a)]),key:a},[Object(o["createElementVNode"])("div",{class:"innerFormField",name:"".concat(e.type,"_triggers")},[Object(o["createVNode"])(l,{uicontrol:"select",name:"".concat(e.type,"_triggers"),"model-value":t,"onUpdate:modelValue":function(t){return e.onChangeTrigger(t,a)},"full-width":!0,options:e.containerTriggers},null,8,["name","model-value","onUpdate:modelValue","options"])],8,Bi),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"icon-edit valign",onClick:function(a){return e.$emit("edit",t)},title:e.translate("General_Edit")},null,8,Ui),[[o["vShow"],t]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"icon-minus valign",onClick:function(t){return e.removeTrigger(a)},title:e.translate("General_Remove")},null,8,Li),[[o["vShow"],a+1!==e.modelValue.length]])],2)),[[o["vShow"],e.containerTriggers.length]])})),128))])]),Object(o["createElementVNode"])("div",xi,[Object(o["createElementVNode"])("div",Ii,[Object(o["createElementVNode"])("span",Pi,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.help)+" ",1),Fi,Hi,Object(o["createElementVNode"])("a",{class:"createTriggerInHelp",onClick:t[1]||(t[1]=function(t){return e.$emit("create")})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)])])])],2)}function $i(e){return Wi(e)||Ri(e)||Ji(e)||Gi()}function Gi(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ji(e,t){if(e){if("string"===typeof e)return zi(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?zi(e,t):void 0}}function Ri(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Wi(e){if(Array.isArray(e))return zi(e)}function zi(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Xi=Object(o["defineComponent"])({props:{type:{type:String,required:!0},help:{type:String,required:!0},title:{type:String,required:!0},containerTriggers:{type:Array,required:!0},modelValue:{type:Array,required:!0}},components:{Field:g["Field"]},emits:["update:modelValue","create","edit"],methods:{onChangeTrigger:function(e,t){var a=$i(this.modelValue);a[t]=parseInt(e,10),this.$emit("update:modelValue",a)},removeTrigger:function(e){var t=$i(this.modelValue);t.splice(e,1),this.$emit("update:modelValue",t)}}});Xi.render=qi;var Ki=Xi,Yi={class:"col s12 m6 input-field"},Qi=["name","id","value"],Zi={class:"col s12 m6 input-field"},er=["name","id","model-value"];function tr(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[Object(o["createElementVNode"])("div",Yi,[Object(o["createElementVNode"])("input",{ref:"dateInput",type:"text",name:"".concat(e.name,"_date"),id:"".concat(e.name,"_date"),class:"dateInput",value:e.dateText,onKeydown:t[0]||(t[0]=function(t){return e.onDateKeydown(t)})},null,40,Qi)]),Object(o["createElementVNode"])("div",Zi,[Object(o["createElementVNode"])("input",{ref:"timeInput",type:"text",name:"".concat(e.name,"_time"),id:"".concat(e.name,"_time"),class:"timeInput","model-value":e.timeText,onKeydown:t[1]||(t[1]=function(t){return e.onTimeKeydown(t)})},null,40,er)])],64)}function ar(e){var t=String(e);return 1===t.length&&(t="0".concat(t)),t}function nr(e){if(e){var t=e;if(t){t="".concat(t).replace(/-/g,"/");try{return new Date("".concat(t," UTC"))}catch(c){try{return new Date(Date.parse("".concat(t," UTC")))}catch(s){var a=t.substr(0,10),n=t.substr(11),i=a.split("/"),r=n.split(":");if(3===i.length&&3===r.length){var o=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10),parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)),l=o.getTime()+6e4*o.getTimezoneOffset();return new Date(l)}}}}}}function ir(e){var t=nr(e);if(t){var a=ar(t.getMonth()+1),n=ar(t.getDate());return"".concat(t.getFullYear(),"-").concat(a,"-").concat(n)}var i=e.split(" ");return i[0]}function rr(e){var t=nr(e);if(t){var a=ar(t.getHours()),n=ar(t.getMinutes()),i=ar(t.getSeconds());return"".concat(a,":").concat(n,":").concat(i)}var r=e.split(" ");return r[1]}function or(e){var t=e;t&&(t=t.replace(/-/g,"/"));try{var a=new Date(t),n=ar(a.getUTCMonth()+1),i=ar(a.getUTCDate()),r=ar(a.getUTCHours()),o=ar(a.getUTCMinutes()),l=ar(a.getUTCSeconds()),c="";return c+="".concat(a.getUTCFullYear(),"-").concat(n,"-").concat(i),c+=" ",c+="".concat(r,":").concat(o,":").concat(l),c}catch(s){return t}}var lr=window,cr=lr.$,sr=Object(o["defineComponent"])({props:{name:{type:String,required:!0},defaultTime:{type:String,required:!0},modelValue:String},mounted:function(){var e=Object.assign(Object.assign({},r["Matomo"].getBaseDatePickerOptions(null)),{},{minDate:new Date});delete e.maxDate,cr(this.$refs.dateInput).datepicker(Object.assign({},e)),cr(this.$refs.timeInput).timepicker({timeFormat:"H:i:s"})},computed:{dateText:function(){return this.modelValue?ir(this.modelValue):""},timeText:function(){return this.modelValue?rr(this.modelValue):""}},methods:{onDateKeydown:function(e){var t=this;setTimeout((function(){var a=e.target.value;t.dateText!==a&&t.onChange(a,t.timeText)}))},onTimeKeydown:function(e){var t=this;setTimeout((function(){var a=e.target.value;t.timeText!==a&&t.onChange(t.dateText,a)}))},onChange:function(e,t){if(e){var a=t||this.defaultTime,n=or("".concat(e," ").concat(a));this.$emit("update:model-value",n)}else this.$emit("update:model-value",null)}}});sr.render=tr;var dr=sr;function ur(e){return ur="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur(e)}function gr(e,t){return pr(e)||mr(e,t)||vr(e,t)||br()}function br(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mr(e,t){var a=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,r=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done);o=!0)if(r.push(n.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==a["return"]||a["return"]()}finally{if(l)throw i}}return r}}function pr(e){if(Array.isArray(e))return e}function fr(e){return Or(e)||jr(e)||vr(e)||hr()}function hr(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function vr(e,t){if(e){if("string"===typeof e)return Tr(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Tr(e,t):void 0}}function jr(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Or(e){if(Array.isArray(e))return Tr(e)}function Tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Vr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yr(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Cr(e,t,a){return t&&yr(e.prototype,t),a&&yr(e,a),e}function Nr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Er=function(){function e(){var t=this;Vr(this,e),Nr(this,"privateState",Object(o["reactive"])({tags:[],isLoadingTags:!1,isLoadingSingle:!1,isUpdating:!1})),Nr(this,"state",Object(o["computed"])((function(){return Object(o["readonly"])(t.privateState)}))),Nr(this,"isLoading",Object(o["computed"])((function(){var e=t.state.value;return e.isLoadingTags||e.isLoadingSingle}))),Nr(this,"isUpdating",Object(o["computed"])((function(){return t.state.value.isUpdating}))),Nr(this,"tags",Object(o["computed"])((function(){return t.state.value.tags}))),Nr(this,"fetchPromise",null),Nr(this,"availableTagsPromises",{})}return Cr(e,[{key:"fetchTags",value:function(e,t){var a=this;return this.privateState.isLoadingTags=!0,this.privateState.tags=[],this.fetchPromise||(this.fetchPromise=r["AjaxHelper"].fetch({method:"TagManager.getContainerTags",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return a.privateState.tags=e,a.privateState.isLoadingTags=!1,a.tags.value})).finally((function(){a.privateState.isLoadingTags=!1}))}},{key:"reload",value:function(e,t){return this.privateState.tags=[],this.fetchPromise=null,this.availableTagsPromises={},this.fetchTags(e,t)}},{key:"findTag",value:function(e,t,a){var n=this,i=this.tags.value.find((function(e){return e.idtag===a}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,r["AjaxHelper"].fetch({idTag:a,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTag",filter_limit:"-1"}).then((function(e){return n.privateState.tags=[].concat(fr(n.privateState.tags),[e]),Object(o["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"fetchAvailableTags",value:function(e){return this.availableTagsPromises[e]||(this.availableTagsPromises[e]=r["AjaxHelper"].fetch({method:"TagManager.getAvailableTagTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(o["readonly"])(e)}))),Promise.resolve(this.availableTagsPromises[e])}},{key:"createOrUpdateTag",value:function(e,t,a,n,i,o,l){var c=this;this.privateState.isUpdating=!0;var s=Object.entries(i).map((function(e){var t=gr(e,2),a=t[0],n=t[1],i=n;return"boolean"===typeof n&&(i=(+n).toString()),[a,i]})),d=Object.fromEntries(s);return r["AjaxHelper"].post({idTag:e.idtag,method:t,idContainer:a,idContainerVersion:n,type:e.type,name:e.name,startDate:e.start_date,endDate:e.end_date,fireLimit:e.fire_limit,fireDelay:e.fire_delay},{parameters:d,fireTriggerIds:o,blockTriggerIds:l},{withTokenInUrl:!0}).finally((function(){c.privateState.isUpdating=!1}))}},{key:"deleteTag",value:function(e,t,a){var n=this;return this.privateState.isUpdating=!0,this.privateState.tags=[],r["AjaxHelper"].fetch({idTag:a,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTag"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}},{key:"suggestNameForType",value:function(e){for(var t=this,a=function(a){var n=e;a&&(n="".concat(n," (").concat(a,")"));var i=!t.tags.value.some((function(e){return e.name===n}));if(i)return{v:n}},n=0;n<100;n+=1){var i=a(n);if("object"===ur(i))return i.v}}}]),e}(),wr=new Er;function Sr(e){return Dr(e)||_r(e)||Mr(e)||kr()}function kr(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Mr(e,t){if(e){if("string"===typeof e)return Ar(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ar(e,t):void 0}}function _r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Dr(e){if(Array.isArray(e))return Ar(e)}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Br(){var e=new Date;return e&&e.toString?e.toString():null}var Ur=window,Lr=Ur.$,xr=Ur.tagManagerHelper,Ir="tagtagmanagement",Pr=Object(o["defineComponent"])({props:{idTag:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTagType:null},components:{TagDateInput:dr,ContentBlock:r["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"],GroupedSettings:g["GroupedSettings"],TagTriggerArray:Ki},data:function(){return{isDirty:!1,showAdvanced:!1,chooseTagType:!1,availableTags:[],containerTriggers:[],currentTime:null,tag:{},editTitle:"",parameterValues:{},isUpdatingTag:!1,fireTriggers:[],blockTriggers:[],currentTimeTimeout:null}},created:function(){var e=this;this.updateAvailableTriggers(),this.setCurrentTime(),wr.reload(this.idContainer,this.idContainerVersion).then((function(){e.initIdTag()}))},unmounted:function(){this.currentTimeTimeout&&clearTimeout(this.currentTimeTimeout)},watch:{idTag:function(e){null!==e&&this.initIdTag()}},methods:{setCurrentTime:function(){this.currentTime=Br(),this.currentTimeTimeout=setTimeout(this.setCurrentTime.bind(this),1e4)},updateAvailableTriggers:function(){var e=this;r["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerTriggers=t.map((function(e){return{key:e.idtrigger,value:e.name}}))}))},removeAnyTagNotification:function(){r["NotificationsStore"].remove(Ir),r["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var a=r["NotificationsStore"].show({message:e,context:t,id:Ir,type:"transient"});setTimeout((function(){r["NotificationsStore"].scrollToNotification(a)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(r["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTag:function(){var e=this;this.tag={},this.chooseTagType=!1,this.editTitle="",r["Matomo"].helper.lazyScrollToContent(),this.availableTags=[],r["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return wr.fetchAvailableTags(e.context)})).then((function(t){e.availableTags=t})).then((function(){if(e.edit&&e.idTag)return e.editTitle=Object(r["translate"])("TagManager_EditTag"),void wr.findTag(e.idContainer,e.idContainerVersion,e.idTag).then((function(t){t&&(e.tag=Object(r["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),e.blockTriggers=Sr(e.tag.block_trigger_ids||[]),e.blockTriggers.length||e.blockTriggers.push(null),e.fireTriggers=Sr(e.tag.fire_trigger_ids||[]),e.fireTriggers.length||e.fireTriggers.push(null),e.onFireTriggerChange(),e.onBlockTriggerChange(),e.isDirty=!1)}));e.create&&(e.editTitle=Object(r["translate"])("TagManager_ChooseTagToContinue"),e.chooseTagType=!0)}))},onCreateNewBlockTrigger:function(){var e=this;this.openEditTrigger((function(t){var a=e.blockTriggers.length-1;e.blockTriggers[a]?e.blockTriggers.push(t.idtrigger):e.blockTriggers[a]=t.idtrigger,e.onBlockTriggerChange()}),0)},onCreateNewFireTrigger:function(){var e=this;this.openEditTrigger((function(t){var a=e.fireTriggers.length-1;e.fireTriggers[a]?e.fireTriggers.push(t.idtrigger):e.fireTriggers[a]=t.idtrigger,e.onFireTriggerChange()}),0)},editTrigger:function(e){this.openEditTrigger((function(){return null}),e)},openEditTrigger:function(e,t){var a=this;xr.editTrigger(null,this.idContainer,this.idContainerVersion,t,(function(t){a.updateAvailableTriggers(),e(t)}))},onBlockTriggerChange:function(){var e=this.blockTriggers.every((function(e){return!!e}));e&&this.addBlockTrigger()},addBlockTrigger:function(){this.blockTriggers.push(null),this.isDirty=!0},removeBlockTrigger:function(e){if(e>-1){var t=this.blockTriggers.length-1;t===e?this.blockTriggers[e]=null:this.blockTriggers.splice(e,1),this.isDirty=!0}},onFireTriggerChange:function(){var e=this.fireTriggers.every((function(e){return!!e}));e&&this.addFireTrigger()},addFireTrigger:function(){this.fireTriggers.push(null),this.isDirty=!0},removeFireTrigger:function(e){if(e>-1){var t=this.fireTriggers.length-1;t===e?this.fireTriggers[e]=null:this.fireTriggers.splice(e,1),this.isDirty=!0}},createTagType:function(e){var t=this;e&&this.isTagTemplateDisabled[e.id]||(this.chooseTagType=!1,this.editTitle=Object(r["translate"])("TagManager_CreateNewTag"),this.tag={idsite:parseInt("".concat(r["Matomo"].idSite),10),name:wr.suggestNameForType(e.name)||"",type:e.id,fire_limit:"unlimited",priority:999,fire_delay:0,typeMetadata:e},this.blockTriggers=[null],this.fireTriggers=[null],this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.isDirty=!1,setTimeout((function(){var e=Lr(t.$refs.root);e.length&&e[0]&&e[0].scrollIntoView(),e.find("#name").focus()}),1))},cancel:function(){var e=Object.assign({},r["MatomoUrl"].hashParsed.value);delete e.idTag,r["MatomoUrl"].updateHash(e)},createTag:function(){var e=this;this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,wr.createOrUpdateTag(this.tag,"TagManager.addContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter((function(e){return!!e})),this.blockTriggers.filter((function(e){return!!e}))).then((function(t){if(t){e.isDirty=!1;var a=t.value;wr.reload(e.idContainer,e.idContainerVersion).then((function(){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTag:a})),setTimeout((function(){var t=Object(r["translate"])("TagManager_CreatedX",Object(r["translate"])("TagManager_Tag")),a=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(t," ").concat(a),"success")}),200)}))}})).finally((function(){e.isUpdatingTag=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateTag:function(){var e=this;this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,wr.createOrUpdateTag(this.tag,"TagManager.updateContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter((function(e){return!!e})),this.blockTriggers.filter((function(e){return!!e}))).then((function(t){if(t){e.isDirty=!1,wr.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdTag()}));var a=Object(r["translate"])("TagManager_UpdatedX",Object(r["translate"])("TagManager_Tag")),n=Object(r["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>");e.showNotification("".concat(a," ").concat(n),"success")}})).finally((function(){e.isUpdatingTag=!1})))},checkRequiredFieldsAreSet:function(){if(!this.tag.name){var e=Object(r["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!(!this.fireTriggers||!this.fireTriggers.length)||(this.showNotification(Object(r["translate"])("TagManager_TagFireTriggerRequirement"),"error"),!1)}},computed:{availableFireLimits:function(){return Mi.fireLimitsOptions.value},isLoading:function(){return ba.isLoading.value||Mi.isLoading.value},isUpdating:function(){return ba.isUpdating.value||this.isUpdatingTag},create:function(){return 0===this.idTag},edit:function(){return!this.create},canUseCustomTemplates:function(){return r["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTagDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.tag.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},isTagTemplateDisabled:function(){var e=this,t={};return this.availableTags.forEach((function(a){a.types.forEach((function(a){t[a.id]=!e.canUseCustomTemplates&&a.isCustomTemplate}))})),t},collectionItemAvatarText:function(){return Object(r["translate"])("TagManager_UseCustomTemplateCapabilityRequired",Object(r["translate"])("TagManager_CapabilityUseCustomTemplates"))},fireLimitHelp:function(){return Object(r["translate"])("TagManager_FireLimitHelp",Object(r["translate"])("TagManager_Unlimited"),Object(r["translate"])("TagManager_OncePage"),Object(r["translate"])("TagManager_Once24Hours"),Object(r["translate"])("TagManager_OnceLifetime"))}}});Pr.render=Ci;var Fr=Pr,Hr=(Object(r["createAngularJsAdapter"])({component:Fr,scope:{idTag:{angularJsBind:"="},idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="},newTagType:{angularJsBind:"="}},directiveName:"piwikTagEdit"}),{class:"tagManagerManageList tagManagerTagList"}),qr={class:"name"},$r={class:"type"},Gr={class:"triggers"},Jr={class:"lastUpdated"},Rr={colspan:"5"},Wr={class:"loadingPiwik"},zr=Object(o["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Xr={colspan:"5"},Kr=["id"],Yr={class:"name"},Qr=["title"],Zr={class:"triggers"},eo=["onClick"],to={key:1,class:"chip"},ao=["onClick"],no=["title"],io={class:"action"},ro=["onClick","title"],oo=["onClick","title"],lo={class:"tableActionBar"},co=Object(o["createElementVNode"])("span",{class:"icon-add"},null,-1),so={class:"ui-confirm",id:"confirmDeleteTag",ref:"confirmDeleteTag"},uo=["value"],go=["value"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function bo(e,t,a,n,i,r){var l=this,c=Object(o["resolveComponent"])("ContentBlock"),s=Object(o["resolveDirective"])("content-table");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Hr,[Object(o["createVNode"])(c,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Tags"))},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",null,Object(o["toDisplayString"])(e.translate("TagManager_TagUsageBenefits")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("table",null,[Object(o["createElementVNode"])("thead",null,[Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("th",qr,Object(o["toDisplayString"])(e.translate("General_Name")),1),Object(o["createElementVNode"])("th",$r,Object(o["toDisplayString"])(e.translate("TagManager_Type")),1),Object(o["createElementVNode"])("th",Gr,Object(o["toDisplayString"])(e.translate("TagManager_Triggers")),1),Object(o["createElementVNode"])("th",Jr,Object(o["toDisplayString"])(e.translate("TagManager_LastUpdated")),1),Object(o["withDirectives"])(Object(o["createElementVNode"])("th",{class:"action"},Object(o["toDisplayString"])(e.translate("General_Actions")),513),[[o["vShow"],e.hasWriteAccess]])])]),Object(o["createElementVNode"])("tbody",null,[Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Rr,[Object(o["createElementVNode"])("span",Wr,[zr,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[o["vShow"],e.isLoading||e.isUpdating]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("tr",null,[Object(o["createElementVNode"])("td",Xr,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_NoTagsFound"))+" ",1),Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"createContainerTagNow",onClick:t[0]||(t[0]=function(t){return e.createTag()})},Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTagNow")),513),[[o["vShow"],e.hasWriteAccess]])])],512),[[o["vShow"],!e.isLoading&&0===e.tags.length]]),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(e.sortedTags,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("tr",{class:"tags",key:t.idtag,id:"tag".concat(t.idtag)},[Object(o["createElementVNode"])("td",Yr,Object(o["toDisplayString"])(t.name),1),Object(o["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(o["toDisplayString"])(t.typeMetadata.name),9,Qr),Object(o["createElementVNode"])("td",Zr,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.fire_trigger_ids,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:a,style:{"margin-right":"3.5px"}},[e.hasWriteAccess?(Object(o["openBlock"])(),Object(o["createElementBlock"])("a",{key:0,style:{display:"inline-block","vertical-align":"top !important"},class:"chip",href:"",onClick:Object(o["withModifiers"])((function(a){return e.editTrigger(t)}),["prevent"])},Object(o["toDisplayString"])(l.triggers[t]),9,eo)):Object(o["createCommentVNode"])("",!0),e.hasWriteAccess?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("span",to,Object(o["toDisplayString"])(l.triggers[t]),1))])})),128)),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",null,[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.translate("TagManager_Except"))+": ",1),(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(t.block_trigger_ids,(function(t,a){return Object(o["openBlock"])(),Object(o["createElementBlock"])("span",{key:a,style:{"margin-right":"3.5px"}},[Object(o["withDirectives"])(Object(o["createElementVNode"])("a",{class:"chip",href:"",onClick:Object(o["withModifiers"])((function(a){return e.editTrigger(t)}),["prevent"])},Object(o["toDisplayString"])(l.triggers[t]),9,ao),[[o["vShow"],e.hasWriteAccess]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("span",{class:"chip"},Object(o["toDisplayString"])(l.triggers[t]),513),[[o["vShow"],!e.hasWriteAccess]])])})),128))],512),[[o["vShow"],t.block_trigger_ids.length]])]),Object(o["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(t.updated_date_pretty),1)],8,no),Object(o["withDirectives"])(Object(o["createElementVNode"])("td",io,[Object(o["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(a){return e.editTag(t.idtag,t.type)},title:e.translate("TagManager_EditTag")},null,8,ro),Object(o["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(a){return e.deleteTag(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Tag"))},null,8,oo)],512),[[o["vShow"],e.hasWriteAccess]])],8,Kr)})),128))])],512),[[s]]),Object(o["withDirectives"])(Object(o["createElementVNode"])("div",lo,[Object(o["createElementVNode"])("a",{class:"createNewTag",value:"",onClick:t[1]||(t[1]=function(t){return e.createTag()})},[co,Object(o["createTextVNode"])(" "+Object(o["toDisplayString"])(e.translate("TagManager_CreateNewTag")),1)])],512),[[o["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(o["createElementVNode"])("div",so,[Object(o["createElementVNode"])("h2",null,Object(o["toDisplayString"])(e.translate("TagManager_DeleteTagConfirm")),1),Object(o["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,uo),Object(o["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,go)],512)])}function mo(e){return vo(e)||ho(e)||fo(e)||po()}function po(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fo(e,t){if(e){if("string"===typeof e)return jo(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?jo(e,t):void 0}}function ho(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function vo(e){if(Array.isArray(e))return jo(e)}function jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var Oo=window,To=Oo.tagManagerHelper,Vo=Object(o["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0}},components:{ContentBlock:r["ContentBlock"]},directives:{ContentTable:r["ContentTable"]},data:function(){return{hasWriteAccess:r["Matomo"].hasUserCapability("tagmanager_write")}},created:function(){var e=this;Object(o["watch"])((function(){return wr.tags.value}),(function(){e.reloadTriggers()})),this.reloadTriggers(),wr.fetchTags(this.idContainer,this.idContainerVersion)},methods:{reloadTriggers:function(){ba.reload(this.idContainer,this.idContainerVersion)},createTag:function(){this.editTag(0)},editTrigger:function(e){var t=this;To.editTrigger(null,this.idContainer,this.idContainerVersion,e,(function(){t.reloadTriggers()}))},editTag:function(e){r["MatomoUrl"].updateHash(Object.assign(Object.assign({},r["MatomoUrl"].hashParsed.value),{},{idTag:e}))},deleteTag:function(e){var t=this,a=function(){wr.deleteTag(t.idContainer,t.idContainerVersion,e.idtag).then((function(){wr.reload(t.idContainer,t.idContainerVersion)}))};r["Matomo"].helper.modalConfirm("#confirmDeleteTag",{yes:a})}},computed:{triggers:function(){var e={};return ba.triggers.value.forEach((function(t){e["".concat(t.idtrigger)]=t.name})),e},isLoading:function(){return wr.isLoading.value},isUpdating:function(){return wr.isUpdating.value},tags:function(){return wr.tags.value},sortedTags:function(){var e=mo(this.tags);return e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),e}}});Vo.render=bo;var yo=Vo,Co=(Object(r["createAngularJsAdapter"])({component:yo,scope:{idContainer:{angularJsBind:"="},idContainerVersion:{angularJsBind:"="}},directiveName:"piwikTagList"}),{class:"manageTag"}),No={key:0},Eo={key:1};
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function wo(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("TagList"),c=Object(o["resolveComponent"])("TagEdit");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Co,[e.editMode?Object(o["createCommentVNode"])("",!0):(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",No,[Object(o["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion},null,8,["id-container","id-container-version"])])),e.editMode?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Eo,[Object(o["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-tag":e.idTag},null,8,["id-container","id-container-version","id-tag"])])):Object(o["createCommentVNode"])("",!0)])}var So=Object(o["defineComponent"])({props:{idContainerVersion:Number,idContainer:String},components:{TagList:yo,TagEdit:Fr},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(o["watch"])((function(){return r["MatomoUrl"].hashParsed.value.idTag}),(function(t){e.onIdTagParamChange(t)})),r["NotificationsStore"].remove("tagtagmanagement"),this.onIdTagParamChange(r["MatomoUrl"].hashParsed.value.idTag)},methods:{onIdTagParamChange:function(e){if("0"===e){var t={isAllowed:!0};r["Matomo"].postEvent("TagManager.initAddTag",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idTag:function(){var e=r["MatomoUrl"].hashParsed.value.idTag;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idTag}}});So.render=wo;var ko=So,Mo=(Object(r["createAngularJsAdapter"])({component:ko,scope:{idContainerVersion:{angularJsBind:"@",transform:function(e){return e?parseInt(e,10):void 0}},idContainer:{angularJsBind:"@"}},directiveName:"piwikTagManage"}),{class:"fieldVariableTemplate"}),_o=["type","id","name","value"],Do=["title"],Ao=["for","innerHTML"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function Bo(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Mo,[Object(o["createElementVNode"])("textarea",Object(o["mergeProps"])({class:"control_".concat(e.uiControl," materialize-textarea"),type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,_o),Object(o["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,Do),Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,Ao)])}var Uo=window,Lo=Uo.tagManagerHelper,xo=Object(o["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;Lo.selectVariable((function(t){Lo.insertTextSnippetAtElement(e.$refs.textarea,"{{".concat(t.id,"}}"))}))}},watch:{modelValue:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}},mounted:function(){var e=this,t=window,a=t.Materialize;setTimeout((function(){a.textareaAutoResize(e.$refs.textarea),a.updateTextFields()}))}});xo.render=Bo;var Io=xo,Po={class:"fieldVariableTemplate"},Fo=["type","id","name","value"],Ho=["title"],qo=Object(o["createElementVNode"])("br",null,null,-1),$o=["for","innerHTML"];function Go(e,t,a,n,i,r){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Po,[Object(o["createElementVNode"])("input",Object(o["mergeProps"])({class:"control_".concat(e.uiControl),type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,Fo),Object(o["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,Ho),qo,Object(o["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,$o)])}var Jo=window,Ro=Jo.tagManagerHelper,Wo=Object(o["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:null},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText:function(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created:function(){this.onKeydown=Object(r["debounce"])(this.onKeydown.bind(this),50)},mounted:function(){setTimeout((function(){window.Materialize.updateTextFields()}))},watch:{modelValue:function(){setTimeout((function(){window.Materialize.updateTextFields()}))}},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;Ro.selectVariable((function(t){Ro.insertTextSnippetAtElement(e.$refs.input,"{{".concat(t.id,"}}"))}))}}});Wo.render=Go;var zo=Wo,Xo=["for","innerHTML"];function Ko(e,t,a,n,i,r){var l=Object(o["resolveComponent"])("VariableSelectType");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",null,[Object(o["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t)})},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(o["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,Xo)])}var Yo=Object(o["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:te},emits:["update:modelValue"]});Yo.render=Ko;var Qo=Yo;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map